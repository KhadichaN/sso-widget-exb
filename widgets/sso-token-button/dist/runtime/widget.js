System.register(["jimu-core","jimu-ui"],(function(e,t){var s={},o={};return{setters:[function(e){s.AppMode=e.AppMode,s.BaseVersionManager=e.BaseVersionManager,s.BrowserSizeMode=e.BrowserSizeMode,s.ButtonClickMessage=e.ButtonClickMessage,s.ExpressionPartType=e.ExpressionPartType,s.ExpressionResolverComponent=e.ExpressionResolverComponent,s.ExpressionResolverErrorCode=e.ExpressionResolverErrorCode,s.Immutable=e.Immutable,s.LinkType=e.LinkType,s.MessageManager=e.MessageManager,s.React=e.React,s.appActions=e.appActions,s.classNames=e.classNames,s.css=e.css,s.getAppStore=e.getAppStore,s.jsx=e.jsx,s.moduleLoader=e.moduleLoader},function(e){o.DistanceUnits=e.DistanceUnits,o.Icon=e.Icon,o.Link=e.Link,o.defaultMessages=e.defaultMessages,o.styleUtils=e.styleUtils,o.utils=e.utils}],execute:function(){e((()=>{var e={891:e=>{"use strict";e.exports=s},726:e=>{"use strict";e.exports=o}},t={};function i(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,i),n.exports}i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="";var n={};return i.p=window.jimuConfig.baseUrl,(()=>{"use strict";i.r(n),i.d(n,{__set_webpack_public_path__:()=>c,default:()=>u});var e,t=i(891),s=i(726);!function(e){e.Left="LEFT",e.Right="RIGHT"}(e||(e={}));class o extends t.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.0.0",description:"The first release.",upgrader:e=>{let t=e;return t.getIn(["styleConfig","name"])&&(t=t.set("styleConfig",t.styleConfig.without("name"))),t.getIn(["styleConfig","customStyle"])&&(t=t.set("styleConfig",t.styleConfig.without("customStyle"))),t.getIn(["styleConfig","themeStyle","quickStyleType"])&&(t=t.setIn(["styleConfig","themeStyle"],{quickStyleType:t.styleConfig.themeStyle.quickStyleType})),t=t.setIn(["styleConfig","useCustom"],!1),t}},{version:"1.1.0",description:"1.1.0",upgrader:e=>{let t=e;return t.getIn(["styleConfig","useCustom"])&&t.getIn(["styleConfig","customStyle","regular","border","width"])&&(t=t.setIn(["styleConfig","customStyle","regular","border","width"],s.utils.stringOfLinearUnit(t.getIn(["styleConfig","customStyle","regular","border","width"])))),t.getIn(["styleConfig","useCustom"])&&t.getIn(["styleConfig","customStyle","hover","border","width"])&&(t=t.setIn(["styleConfig","customStyle","hover","border","width"],s.utils.stringOfLinearUnit(t.getIn(["styleConfig","customStyle","hover","border","width"])))),t}},{version:"1.12.0",description:"fix icon picker config",upgrader:e=>{let t=e;if(t.getIn(["functionConfig","icon","data"])){const e={svg:t.getIn(["functionConfig","icon","data"]),properties:{filename:""}};t=t.setIn(["functionConfig","icon","data"],e)}return t}}]}}const r=new o;function p(e,o,i){const n=e?"default":"hover",r=(0,t.Immutable)(i),p=r.getIn(["components","button","variants",o,n,"color"]),l=r.getIn(["components","button","sizes","default","fontSize"]);return{color:p,size:parseFloat(s.styleUtils.remToPixel(l))}}var l;!function(e){e[e.None=0]="None",e[e.Main=1]="Main",e[e.Sub=2]="Sub"}(l||(l={}));class a extends t.React.PureComponent{constructor(o){var i,n,r,a,u;super(o),this.repeat=0,this.getTextFromProps=()=>{var e,t,o,i;return"string"==typeof(null===(t=null===(e=this.props.config)||void 0===e?void 0:e.functionConfig)||void 0===t?void 0:t.text)?null===(i=null===(o=this.props.config)||void 0===o?void 0:o.functionConfig)||void 0===i?void 0:i.text:this.props.intl.formatMessage({id:"variableButton",defaultMessage:s.defaultMessages.variableButton})},this.setRepeatType=()=>{const e=this.props.repeatedDataSource;let t;t=e?0===e.recordIndex?l.Main:l.Sub:l.None,this.repeat=t},this.getTipExpression=()=>{var e,s;return this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTipExpression&&this.props.config.functionConfig.toolTipExpression||(0,t.Immutable)({name:"",parts:[{type:t.ExpressionPartType.String,exp:`"${(null===(s=null===(e=this.props.config)||void 0===e?void 0:e.functionConfig)||void 0===s?void 0:s.toolTip)||""}"`}]})},this.getTextExpression=()=>{var e,s;return this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.textExpression&&this.props.config.functionConfig.textExpression||(0,t.Immutable)({name:"",parts:[{type:t.ExpressionPartType.String,exp:`"${(null===(s=null===(e=this.props.config)||void 0===e?void 0:e.functionConfig)||void 0===s?void 0:s.text)||this.getTextFromProps()}"`}]})},this.getUrlExpression=()=>this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.expression||null,this.onTextExpResolveChange=e=>{if(e.isSuccessful)this.setState({text:e.value});else{let s="";e.value===t.ExpressionResolverErrorCode.Failed&&(s=this.state.textExpression&&this.state.textExpression.name),this.setState({text:s})}},this.onTipExpResolveChange=e=>{e.isSuccessful?this.setState({toolTip:e.value}):this.setState({toolTip:""})},this.onUrlExpResolveChange=e=>{if(e.isSuccessful)this.setState({url:e.value});else{let s="";e.value===t.ExpressionResolverErrorCode.Failed&&(s=this.state.urlExpression&&this.state.urlExpression.name),this.setState({url:s})}},this.showQuickStylePanel=()=>{const{showQuickStyle:e,browserSizeMode:s}=this.props;if(!window.jimuConfig.isInBuilder)return!1;if(s===t.BrowserSizeMode.Small)return!1;const o=this.repeat,{active:i}=this.props;return e&&i&&o!==l.Sub},this.getWhetherUseQuickStyle=e=>!!(e&&e.styleConfig&&e.styleConfig.themeStyle&&e.styleConfig.themeStyle.quickStyleType),this.getIconStyle=(e,o)=>{const i=e||{},n=o||{};return t.css`
      & img, & svg{
        color: ${i.color};
        fill: ${i.color};
        width: ${i.size}${s.DistanceUnits.PIXEL};
        height: ${i.size}${s.DistanceUnits.PIXEL};
      }
      &:hover{
        img, svg{
          color: ${n.color};
          fill: ${n.color};
          width: ${n.size}${s.DistanceUnits.PIXEL};
          height: ${n.size}${s.DistanceUnits.PIXEL};
        }
      }
    `},this.removeUndefinedStyle=e=>{if(!e)return e;const t={};return Object.keys(e).forEach((s=>{("string"==typeof e[s]&&e[s].indexOf("undefined")<0||"number"==typeof e[s])&&(t[s]=e[s])})),t},this.getLinkComponent=()=>{var o,i,n,r;const p=this.props.config,l=p.functionConfig.linkParam,a=this.state.text,u=this.state.toolTip;let c,g,d=this.state.toolTip||a||(null===(r=null===(n=null===(i=null===(o=p.functionConfig)||void 0===o?void 0:o.icon)||void 0===i?void 0:i.data)||void 0===n?void 0:n.properties)||void 0===r?void 0:r.filename);if(p.styleConfig&&p.styleConfig.customStyle){const e=p.styleConfig.customStyle.regular,o=p.styleConfig.customStyle.hover;if(p.styleConfig.useCustom){const i=s.styleUtils.toCSSStyle(e&&e.without("iconProps").asMutable({deep:!0})),n=s.styleUtils.toCSSStyle(o&&o.without("iconProps").asMutable({deep:!0}));if(this.props.active&&this.props.appMode!==t.AppMode.Run){const s=(0,t.getAppStore)().getState().widgetsState[this.props.id]||(0,t.Immutable)({});c={style:s.isConfiguringHover?Object.assign(Object.assign({},this.removeUndefinedStyle(i)),this.removeUndefinedStyle(n)):i,hoverStyle:n},g=this.getIconStyle(s.isConfiguringHover?Object.assign(Object.assign({},null==e?void 0:e.iconProps),null==o?void 0:o.iconProps):null==e?void 0:e.iconProps,null==o?void 0:o.iconProps)}else c={style:i,hoverStyle:n},g=this.getIconStyle(e&&e.iconProps,o&&o.iconProps)}}const h=this.getWhetherUseQuickStyle(p)?{type:p.styleConfig.themeStyle.quickStyleType}:{type:"default"};let f,y,v;if(l&&l.linkType)if(y=l.openType,v={linkType:l.linkType},l.linkType===t.LinkType.WebAddress){let e=this.state.url;const t=this.state.arcgisToken;if(t){const s=e.includes("?")?"&":"?";e=`${e}${s}token=${encodeURIComponent(t)}`}v.value=e}else v.value=l.value,f=this.props.queryObject;const m=p.functionConfig.icon,S=this.props.isRTL,C=m&&(!m.position||m.position===e.Left)&&(0,t.jsx)(s.Icon,{icon:m.data.svg,className:(0,t.classNames)({"mr-2 ml-0":!!a&&!S,"ml-2 mr-0":!!a&&S,"mx-0":!a})}),x=m&&m.position&&m.position===e.Right&&(0,t.jsx)(s.Icon,{icon:m.data.svg,className:(0,t.classNames)({"ml-2 mr-0":!!a&&!S,"mr-2 ml-0":!!a&&S,"mx-0":!a})});return"_blank"===y&&(d=`${d}, ${this.props.intl.formatMessage({id:"openInNewWindow"})}`),(0,t.jsx)(s.Link,Object.assign({to:v,target:y,queryObject:f,title:u,className:"widget-button-link text-truncate w-100 h-100 p-0 d-flex align-items-center justify-content-center",role:(null==v?void 0:v.value)&&v.linkType!==t.LinkType.Dialog?"link":"button",customStyle:c},h,{css:g,"aria-label":d}),(0,t.jsx)("span",{className:"text-truncate widget-button-text"},S?x:C,a,S?C:x))},this.onQuickStyleChange=e=>{let{config:t}=this.props;const s=this.props.id,o=this.props.builderSupportModules,i=o&&o.jimuForBuilderLib.getAppConfigAction;i&&(t=t.setIn(["styleConfig","useCustom"],!1),t=t.setIn(["styleConfig","themeStyle","quickStyleType"],e),t=t.setIn(["styleConfig","customStyle","regular"],{iconProps:p(!0,e,this.props.theme)}),t=t.setIn(["styleConfig","customStyle","hover"],{iconProps:p(!1,e,this.props.theme)}),i().editWidgetProperty(s,"config",t).exec())},this.onClick=e=>{e.exbEventType="linkClick",t.MessageManager.getInstance().publishMessage(new t.ButtonClickMessage(this.props.id))},this.onQuickStyleClose=()=>this.props.dispatch(t.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!1)),this.getQuickStyleComponent=()=>{var e,s,o,i,n;const r=this.props.builderSupportModules&&this.props.builderSupportModules.widgetModules&&this.props.builderSupportModules.widgetModules.QuickStyle;return r?(0,t.jsx)(r,{onChange:this.onQuickStyleChange,reference:this.domNode&&this.domNode.current,onClose:this.onQuickStyleClose,selectedType:!(null===(s=null===(e=this.props.config)||void 0===e?void 0:e.styleConfig)||void 0===s?void 0:s.useCustom)&&(null===(n=null===(i=null===(o=this.props.config)||void 0===o?void 0:o.styleConfig)||void 0===i?void 0:i.themeStyle)||void 0===n?void 0:n.quickStyleType),onInitDragHandler:this.props.onInitDragHandler,onInitResizeHandler:this.props.onInitResizeHandler,intl:this.props.intl,usePopper:!0}):null},this.state={text:this.getTextFromProps(),toolTip:(null===(n=null===(i=this.props.config)||void 0===i?void 0:i.functionConfig)||void 0===n?void 0:n.toolTip)||"",url:(null===(u=null===(a=null===(r=this.props.config)||void 0===r?void 0:r.functionConfig)||void 0===a?void 0:a.linkParam)||void 0===u?void 0:u.value)||"",textExpression:this.props.useDataSourcesEnabled&&this.getTextExpression(),tipExpression:this.props.useDataSourcesEnabled&&this.getTipExpression(),urlExpression:this.props.useDataSourcesEnabled&&this.getUrlExpression(),mouted:!1},this.domNode=t.React.createRef()}componentDidMount(){var e,s;try{const t=null!==(e=localStorage.getItem("exb_auth"))&&void 0!==e?e:sessionStorage.getItem("exb_auth");if(t){const e=null===(s=JSON.parse(t))||void 0===s?void 0:s.token;e&&this.setState({arcgisToken:e})}}catch(e){console.warn("Cannot parse exb_auth:",e)}window.jimuConfig.isInBuilder&&(this.setRepeatType(),this.props.active&&!this.props.hasEverMount&&this.props.dispatch(t.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!0)),this.props.hasEverMount||this.props.dispatch(t.appActions.widgetStatePropChange(this.props.id,"hasEverMount",!0)),this.setState({mouted:!0}))}componentDidUpdate(e,s){const{id:o,uri:i,showQuickStyle:n,browserSizeMode:r}=this.props;this.props.useDataSourcesEnabled||this.props.config===e.config&&!e.useDataSourcesEnabled||this.setState({text:this.getTextFromProps(),toolTip:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTip,url:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.value}),!this.props.useDataSourcesEnabled||this.props.config===e.config&&e.useDataSourcesEnabled||this.setState({textExpression:this.getTextExpression(),tipExpression:this.getTipExpression(),urlExpression:this.getUrlExpression()}),window.jimuConfig.isInBuilder&&(this.props.appMode!==e.appMode&&this.props.appMode===t.AppMode.Run||!this.props.active&&e.active)&&this.props.dispatch(t.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!1));const p=n!==e.showQuickStyle,l=r===t.BrowserSizeMode.Small;p&&l&&t.moduleLoader.getModuleSync("jimu-for-builder").appBuilderSync.publishSidePanelToApp({type:"buttonQuickStyle",widgetId:o,uri:i,onChange:this.onQuickStyleChange,active:n})}render(){const e=this.props.useDataSourcesEnabled,s=this.showQuickStylePanel(),o=this.getLinkComponent(),i=this.getQuickStyleComponent();return(0,t.jsx)("div",{className:"jimu-widget widget-button w-100 h-100",css:(this.props.theme,t.css`
    &>a {
      display: flex !important;
      justify-content: center;
    }

    .widget-button-text{
      line-height: 1;
    }

  `),ref:this.domNode,onClick:this.onClick,onTouchEnd:this.onClick},o,s&&i,(0,t.jsx)("div",{style:{display:"none"}},e&&(0,t.jsx)("div",null,(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.textExpression,onChange:this.onTextExpResolveChange,widgetId:this.props.id}),(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.tipExpression,onChange:this.onTipExpResolveChange,widgetId:this.props.id}),(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.urlExpression,onChange:this.onUrlExpResolveChange,widgetId:this.props.id}))))}}a.mapExtraStateProps=(e,s)=>{var o;let i=!1;const n=e.appRuntimeInfo.selection;if(n&&e.appConfig.layouts[n.layoutId]){const t=e.appConfig.layouts[n.layoutId].content[n.layoutItemId];i=t&&t.widgetId===s.id}const r=e.appContext.isInBuilder&&i,p=e.widgetsState[s.id]||(0,t.Immutable)({});return{active:r,showQuickStyle:!!p.showQuickStyle,appMode:r?e.appRuntimeInfo.appMode:null,queryObject:e.queryObject,hasEverMount:p.hasEverMount,isRTL:e.appContext.isRTL,browserSizeMode:e.browserSizeMode,uri:null===(o=e.appConfig.widgets[s.id])||void 0===o?void 0:o.uri}},a.versionManager=r;const u=a;function c(e){i.p=e}})(),n})())}}}));